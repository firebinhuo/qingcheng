<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品类目统计</title>
    <link href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" rel="stylesheet">
    <link href="../plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body>
<div id="app">
    <el-date-picker
            @change="fetchData()"
            end-placeholder="结束日期"
            range-separator="至"
            start-placeholder="开始日期"
            type="daterange"
            v-model="dataRange">
    </el-date-picker>
    <el-table
            :data="tableData"
            border
            style="width: 100%">
        <el-table-column
                label="分类名称"
                prop="category1Name"
                width="250">
        </el-table-column>
        <el-table-column
                label="销售量"
                prop="num"
                width="250">
        </el-table-column>
        <el-table-column
                label="销售量占比"
                width="250">
            <template slot-scope="scope">
                {{((scope.row.num/totalNum)*100).toFixed(2)}}%
            </template>
        </el-table-column>
        <el-table-column
                label="销售额"
                prop="money"
                width="250">
        </el-table-column>
        <el-table-column
                label="销售额占比"
                width="250">
            <template slot-scope="scope">
                {{(scope.row.money/totalMoney*100).toFixed(2)}}%
            </template>
        </el-table-column>
    </el-table>
</div>

<script src="/js/vue.js"></script>
<script src="/js/axios.js"></script>
<script src="/js/elementui.js"></script>
<script src="/js/util.js"></script>
<script>
    new Vue({
        el: "#app",
        data() {
            return {
                tableData: [],
                dataRange: [],
                totalNum: 0,
                totalMoney: 0
            }
        },
        methods: {
            fetchData() {
                let startDate = this.dataRange[0].Format("yyyy-MM-dd");
                let endDate = this.dataRange[1].Format("yyyy-MM-dd");
                axios.get(`/categoryReport/category1Count.do?date1=${startDate}&date2=${endDate}`).then(res => {
                    console.log(res.data)
                    this.tableData = res.data
                    //计算总的销售数量与销售金额
                    this.totalNum = 0
                    this.totalMoney = 0
                    for (let i = 0; i < this.tableData.length; i++) {
                        this.totalNum += this.tableData[i].num;
                        this.totalMoney += this.tableData[i].money;
                    }
                })
            }
        }
    })
</script>
</body>
</html>